<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<!-- Apple devices fullscreen -->
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<!-- Apple devices fullscreen -->
	<meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<title>自然堂</title>

	<!-- Bootstrap CSS框架-->
	<link rel="stylesheet" href="adminskin/css/bootstrap.min.css">
	<!-- Bootstrap responsive 响应式布局CSS框架-->
	<link rel="stylesheet" href="adminskin/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="adminskin/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="adminskin/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- timepicker时间选择器 -->
	<link rel="stylesheet" href="adminskin/css/plugins/timepicker/bootstrap-timepicker.min.css">
	<!-- colorpicker颜色选择器-->
	<link rel="stylesheet" href="adminskin/css/plugins/colorpicker/colorpicker.css">
	<!-- Datepicker日期选择器 -->
	<link rel="stylesheet" href="adminskin/css/plugins/datepicker/datepicker.css">
	<!-- chosen选择  -->
	<link rel="stylesheet" href="adminskin/css/plugins/chosen/chosen.css">
	<!-- multi select 多选-->
	<link rel="stylesheet" href="adminskin/css/plugins/multiselect/multi-select.css">
	<!-- Tagsinput 添加标签 -->
	<link rel="stylesheet" href="adminskin/css/plugins/tagsinput/jquery.tagsinput.css">
	<!-- 界面 CSS -->
	<link rel="stylesheet" href="adminskin/css/style.css">
	<!-- 肤色 CSS -->
	<link rel="stylesheet" href="adminskin/css/themes.css">
	<!-- 自定义 CSS -->
	<link rel="stylesheet" href="adminskin/css/customerui.css">


	<!-- jQuery -->
	<script src="adminskin/js/jquery.min.js"></script>
	
	<!-- 滚动条插件 -->
	<script src="adminskin/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
	<!-- imagesLoaded 图像堆叠 -->
	<script src="adminskin/js/plugins/imagesLoaded/jquery.imagesloaded.min.js"></script>
	<!-- jQuery UI -->
	<script src="adminskin/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
	<script src="adminskin/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
	<script src="adminskin/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
	<script src="adminskin/js/plugins/jquery-ui/jquery.ui.draggable.min.js"></script>
	<script src="adminskin/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
	<script src="adminskin/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
	<!-- Touch enable for jquery UI 触摸设备支持-->
	<script src="adminskin/js/plugins/touch-punch/jquery.touch-punch.min.js"></script>
	<!-- slimScroll 悬停滚动条 -->
	<script src="adminskin/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<!-- Bootstrap 前端CSS/HTML开发框架 -->
	<script src="adminskin/js/bootstrap.min.js"></script>
	<!-- bootbox 对话框 -->
	<script src="adminskin/js/plugins/bootbox/jquery.bootbox.js"></script>
	<!-- Datepicker日期选择器 -->
	<script src="adminskin/js/plugins/datepicker/bootstrap-datepicker.js"></script>
	<!-- Timepicker时间选择器 -->
	<script src="adminskin/js/plugins/timepicker/bootstrap-timepicker.min.js"></script>
	<!-- Colorpicker颜色选择器 -->
	<script src="adminskin/js/plugins/colorpicker/bootstrap-colorpicker.js"></script>
	<!-- Custom file upload文件上传 -->
	<script src="adminskin/js/plugins/fileupload/bootstrap-fileupload.min.js"></script>
	<script src="adminskin/js/plugins/mockjax/jquery.mockjax.js"></script>
	<!-- Chosen选择 -->
	<script src="adminskin/js/plugins/chosen/chosen.jquery.min.js"></script>
	<!-- MultiSelect 多选-->
	<script src="adminskin/js/plugins/multiselect/jquery.multi-select.js"></script>
	<!-- Filetree 树 -->
	<script src="adminskin/js/plugins/dynatree/jquery.dynatree.js"></script>
	<!-- TagsInput添加标签 -->
	<script src="adminskin/js/plugins/tagsinput/jquery.tagsinput.min.js"></script>
	<!-- CKEditor编辑器 标准版 -->
	<script src="adminskin/js/plugins/ckeditor/ckeditor.js"></script>
	<!-- CKFinder文件管理器 CKEditor版 -->
	<script src="adminskin/js/plugins/ckfinder/ckfinder.js"></script>

	<!-- Theme framework -->
	<script src="adminskin/js/eakroko.min.js"></script>
	<!-- Theme scripts -->
	<script src="adminskin/js/application.min.js"></script>
	<!-- Just for demonstration -->
	<script src="adminskin/js/demonstration.min.js"></script>

	<!--[if lte IE 9]>
		<script src="adminskin/js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->
	
	<!-- Favicon -->
	<link rel="shortcut icon" href="adminskin/img/favicon.ico" />
	<!-- Apple devices Homescreen icon -->
	<link rel="apple-touch-icon-precomposed" href="adminskin/img/apple-touch-icon-precomposed.png" />
 <script>
    
 $(function () {
 	
 	
 	var initName=GetQueryString("productName");
 
 	initData(initName);
 })
 function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
}
 function stringG(url){
 	
 	var str = url;
 	var index = str.lastIndexOf("/");  
 	str = str.substring(index+1, str.length);
 	return str;
 }
 function initData(name){
	 
	 $.ajax({
         async: false,
         type: "POST",
         url:"/zrtweb/auth/edit_product",
         data: {
        	productName:name
         },
         success: function (data, textStatus) {
        	 if (data.retCode == 0) {
        	 $("#productName").val(data.obj.productName);
        	 $("#oldName").val(data.obj.productName);
        	 $("#productDesc").val(data.obj.productDesc);
        	 $("#seriesName").val(data.obj.seriesName);
        	
        	 if(data.obj.productPic!=null){
        		 
        		 $("#imageId").attr("src",data.obj.productPic);
        	 }else{
        		 $("#imageId").attr("src","/adminskin/img/noimage.gif");
        	 }
			if(data.obj.videoPic!=null){
        		 
        		 $("#imageId2").attr("src",data.obj.videoPic);
        	 }else{
        		 $("#imageId2").attr("src","/adminskin/img/noimage.gif");
        	 }
			if(data.obj.codePic!=null){
       		 
       		 $("#imageId3").attr("src",data.obj.codePic);
       	 }else{
       		 $("#imageId3").attr("src","/adminskin/img/noimage.gif");
       	 }
			//console.log(data.obj.videoUrl);
			$("#audioName").text(stringG(data.obj.videoUrl));
			$("#audiohref").attr("href",data.obj.videoUrl); 
			$("#audioNamepreview").text(stringG(data.obj.videoUrl));
        	$("#vedio").text(stringG(data.obj.audioUrl));
        	$("#vediohref").attr("href",data.obj.audioUrl); 
        	$("#vedioprview").text(stringG(data.obj.audioUrl));
        	$("#selectDemo").find("option[value="+data.obj.templateId+"]").attr("selected",true); 
        	//$(".selector").find("option[text='pxx']").attr("selected",true); 
        	
        	 }
         }
	 })
 }
    function saveBtn(){
    	 var fd = new FormData();
         var file = document.getElementById('upload_file').files[0];
         var file1 = document.getElementById('upload_file_audiopic').files[0];
         var file2 = document.getElementById('upload_file_audio').files[0];
         var file3 = document.getElementById('upload_file_vedio').files[0];
         var file4 = document.getElementById('upload_file_codePic').files[0];
         fd.append('file0', file); 
         fd.append('file2', file1); 
         fd.append('file1', file2); 
         fd.append('file3', file3); 
         fd.append('file4', file4); 
          fd.append('templateId',$("#selectDemo").find("option:selected").val());
          fd.append('productName',$("#productName").val());
          fd.append('oldName',$("#oldName").val());
          fd.append('productDesc',$("#productDesc").val());
          fd.append('seriesName',$("#seriesName").val());
         
          
    	 $.ajax({
           async: false,
           type: "POST",
           url:"/zrtweb/auth/update",
           data: fd,
           processData: false,  
           contentType: false,
           success: function (data, textStatus) {
          	 if (data.retCode == 0) {
          		initData($("#productName").val());
               	alert("修改成功！");
               	location = 'product_list.html';
               	 }else{
               		 alert("修改失败！")
               	 }
           }
    	 })
    }
    </script>
</head>

<body>
	<div id="navigation">
		<div class="container-fluid">
			<a href="#" id="brand">自然堂</a>
			<a href="#" class="toggle-nav" rel="tooltip" data-placement="bottom" title="收起侧栏"><i class="icon-reorder"></i></a>
		</div>
	</div>
	<div class="container-fluid" id="content">
		<div id="left">
			<div class="subnav">
				<div class="subnav-title">
					<a href="#" class='toggle-subnav'><i class="icon-angle-down"></i><span>扫码产品管理</span></a>
				</div>
				<ul class="subnav-menu">
                    <li>
                        <a href="product_add.html">添加产品</a>
                    </li>
                    <li>
                        <a href="product_list.html">产品管理</a>
                    </li>
				</ul>
			</div>
		</div>
		<div id="main">
			<div class="container-fluid">
				<div class="row-fluid">
					<div class="span12">
						<div class="box box-bordered">
							<div class="box-title">
								<h3><i class="icon-th-list"></i> 添加扫码产品</h3>
							</div>
							<div class="box-content nopadding">
								<form action="#" class='form-horizontal form-striped'>
									<div class="control-group">
										<label for="textfield" class="control-label">产品名称<small>用以匹配的产品名称</small></label>
										<div class="controls">
											<input type="text" name="textfield" id="productName" placeholder="" class="input-xlarge">
											<input type="hidden" name="textfield" id="oldName" value=""/>
										</div>
									</div>
									<div class="control-group">
										<label for="textfield1" class="control-label">系列名称</label>
										<div class="controls">
											<input type="text" name="textfield1" id="seriesName" placeholder="" class="input-xlarge">
										</div>
									</div>
                                    <div class="control-group">
                                        <label for="textfield" class="control-label">产品描述</label>
                                        <div class="controls">
                                            <textarea name="textarea" id="productDesc" rows="5" placeholder="" class="input-block-level"></textarea>
                                            <!--<span class="help-block">提示信息示例</span>-->
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label for="textfield" class="control-label">产品图片上传</label>
                                        <div class="controls">
                                            <div class="fileupload fileupload-exists" data-provides="fileupload">
                                                <input type="hidden" value="" name="">
                                                <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;"><img src="adminskin/img/noimage.gif"></div>
                                                <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 133px;"><img src="" id="imageId" style="max-height: 150px;"></div>
                                                <div>
                                                    <span class="btn btn-file"><span class="fileupload-new">选择图片</span><span class="fileupload-exists">更改</span><input id="upload_file" type="file" name="file" /></span>
                                                    <a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
									<div class="control-group">
										<label for="textfield" class="control-label">音频上传</label>
										<div class="controls">
                                            <a id="vediohref" href="" target="_blank"><span id="vedio"></span></a>
                                            <div class="fileupload fileupload-exists" data-provides="fileupload">
                                                <input type="hidden" value="" name="">
                                                <div class="input-append">
                                                    <div class="uneditable-input span3"><i class="icon-file fileupload-exists"></i> <span id="vedioprview" class="fileupload-preview"></span></div><span class="btn btn-file"><span class="fileupload-new">选择文件</span><span class="fileupload-exists">更改</span><input type="file" id="upload_file_audio" name="file"/></span><a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
                                                </div>
                                            </div>
											<span class="help-block">文件大小请限制在5M以内</span>
										</div>
									</div>
									<div class="control-group">
										<label for="textfield" class="control-label">视频图片上传</label>
                                        <div class="controls">
                                            <div class="fileupload fileupload-exists" data-provides="fileupload">
                                                <input type="hidden" value="" name="">
                                                <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;"><img src="adminskin/img/noimage.gif"></div>
                                                <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 133px;"><img id="imageId2" src="" style="max-height: 150px;"></div>
                                                <div>
                                                    <span class="btn btn-file"><span class="fileupload-new">选择图片</span><span class="fileupload-exists">更改</span><input type="file" id="upload_file_audiopic" name="file" /></span>
                                                    <a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
                                                </div>
                                            </div>
                                        </div>
									</div>
                                    <div class="control-group">
                                        <label for="textfield" class="control-label">视频上传</label>
                                        <div class="controls">
                                            <a  id="audiohref" href="" target="_blank"><span id="audioName"></span></a>
                                            <div class="fileupload fileupload-exists" data-provides="fileupload">
                                                <input type="hidden" value="" name="">
                                                <div class="input-append">
                                                    <div class="uneditable-input span3"><i class="icon-file fileupload-exists"></i> <span id="audioNamepreview" class="fileupload-preview"></span></div><span class="btn btn-file"><span class="fileupload-new">选择文件</span><span class="fileupload-exists">更改</span><input type="file" id="upload_file_vedio"  name="file"/></span><a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
                                                </div>
                                            </div>
                                            <span class="help-block">视频大小请限制在50M以内</span>
                                        </div>
                                    </div>
									<div class="control-group">
										<label for="select" class="control-label">选择模板</label>
										<div class="controls">
											<select name="select" id="selectDemo" class='input-large'>
												<option value="1">1</option>
												<option value="2">2</option>
												<option value="3">3</option>
												<option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                                <option value="19">19</option>
                                                <option value="20">20</option>
											</select>
										</div>
									</div>
									 <div class="control-group">
										<label for="textfield" class="control-label">防伪图片上传</label>
                                        <div class="controls">
                                            <div class="fileupload fileupload-exists" data-provides="fileupload">
                                                <input type="hidden" value="" name="">
                                                <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;"><img src="adminskin/img/noimage.gif"></div>
                                                <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 133px;"><img id="imageId3" src="" style="max-height: 150px;"></div>
                                                <div>
                                                    <span class="btn btn-file"><span class="fileupload-new">选择图片</span><span class="fileupload-exists">更改</span><input type="file" id="upload_file_codePic" name="file" /></span>
                                                    <a href="#" class="btn fileupload-exists" data-dismiss="fileupload">移除</a>
                                                </div>
                                            </div>
                                        </div>
									</div>
									<div class="form-actions">
										<button type="button" class="btn btn-primary" onclick="saveBtn();" >保存</button>
										<button type="button" class="btn" onclick="location ='product_list.html'">取消</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
<!-- 编辑器 整合 文件管理-->
<script src="adminskin/js/customerui.js"></script>
</body>
</html>